<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuestionario Interactivo Aleatorio Licencia Clase B</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos adicionales */
        body {
            font-family: 'Inter', sans-serif; /* Fuente Inter */
        }
        /* Estilo para resaltar respuestas */
        /* Asegurar prioridad de estilos */
        .correct {
            background-color: #22c55e !important;
            border-color: #16a34a !important;
        }

        .incorrect {
            background-color: #ef4444 !important;
            border-color: #dc2626 !important;
        }

        .selected-correct::after {
            content: "✓";
            margin-left: 10px;
            font-weight: bold;
            color: white;
        }
        /* Estilo para la opción seleccionada antes de revisar */
        .selected {
            border-color: #3b82f6 !important; /* Azul */
            background-color: #eff6ff !important; /* Azul claro */
            border-width: 2px;
        }
        /* Estilo para botones deshabilitados */
        button:disabled:not(.correct):not(.incorrect) { /* No aplicar opacidad a los botones ya coloreados */
            opacity: 0.7;
            cursor: not-allowed;
        }
        /* Asegurar que el botón de reiniciar siempre esté visible */
        #start-over-button-container {
            position: sticky;
            top: 1rem; /* Ajusta según sea necesario */
            z-index: 10;
            text-align: right; /* Alinea el botón a la derecha */
            margin-bottom: 1rem; /* Espacio debajo del botón */
        }
        /* Clases para visibilidad */
        .hidden {
            display: none;
        }
        .visible {
            display: block; /* O inline-block, flex, etc., según el elemento */
        }
        .invisible {
            visibility: hidden;
        }
        /* Agregar estos estilos */
        #start-screen {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-6 md:p-8 rounded-lg shadow-xl w-full max-w-2xl relative">
        <div id="start-over-button-container">
             <button id="start-over-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out text-sm">
                Comenzar de nuevo
            </button>
        </div>

        <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-6">Cuestionario Licencia Clase B (Aleatorio)</h1>
        <div id="start-screen" class="text-center">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Instrucciones del Examen</h2>
            <div class="bg-gray-50 p-6 rounded-lg mb-8 text-left space-y-4">
                <p class="text-gray-700">• El examen consta de 4 preguntas:</p>
                <p class="text-gray-700">• 3 preguntas valen <span class="font-bold">1 punto</span> cada una</p>
                <p class="text-gray-700">• 1 pregunta vale <span class="font-bold">2 puntos</span></p>
                <p class="text-gray-700">• Puntaje máximo posible: <span class="font-bold">5 puntos</span></p>
                <p class="text-gray-700">• Para aprobar se requiere: <span class="font-bold text-green-600">Mínimo 4 puntos</span></p>
            </div>
            <button id="start-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200 ease-in-out text-lg">
                Comenzar Examen
            </button>
        </div>
        <div id="quiz-container" class="hidden">
            <div class="mb-4 text-sm text-gray-600 flex justify-between items-center">
                <span id="question-counter">Pregunta 1 de 4</span>
                <span id="score">Puntaje: 0</span>
            </div>

            <div id="question-area" class="mb-6">
                <p id="question-text" class="text-lg text-gray-700 font-medium"></p>
            </div>

            <div id="options-area" class="space-y-3">
                </div>

            <div id="feedback-area" class="mt-4 text-center font-medium h-6">
                </div>

            <div class="mt-6 text-center space-x-4">
                 <button id="check-button" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200 ease-in-out invisible">
                    Revisar
                </button>
                <button id="next-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition duration-200 ease-in-out invisible">
                    Siguiente
                </button>
            </div>
        </div>

        <div id="results-container" class="hidden text-center">
             <!-- Eliminar el elemento final-score duplicado -->
    <div id="dynamic-results-content"></div> <!-- Contenedor para contenido dinámico -->
            <button id="restart-button" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg transition duration-200 ease-in-out">
                Intentar con otras 10 preguntas
            </button>
        </div>
    </div>

    <script>
        // --- Base de Datos Completa de Preguntas ---
        const allQuestions = [
             // ... (Las 20 preguntas van aquí, igual que antes) ...
             {
                question: "1.- Su vehículo se desvia hacia un lado cuando usted frena. Usted deberia:",
                options: [
                    "a) Cambiar los neumáticos de un lado hacia el otro y viceversa.",
                    "b) Bombear el pedal al frenar.",
                    "c) Usar su freno de mano.",
                    "d) Consultar con su mecánico lo antes posible."
                ],
                correctAnswer: "d",
                points: 1
            },
            {
                question: "2.- Su vehículo se desvía hacia un lado cuando usted frena. ¿Cuál es la falla más probable?",
                options: [
                    "a) Un bajo nivel del liquido de frenos.",
                    "b) Su freno de mano está todavía puesto.",
                    "c) Frenos mal ajustados.",
                    "d) Neumáticos con presión de aire inadecuada."
                ],
                correctAnswer: "c",
                points: 1
            },
            {
                question: "3.- Mientras conduce usted siente un fuerte olor a gasolina. ¿Qué debería hacer usted?",
                options: [
                    "a) No preocuparse, ya que sólo son los gases de escape.",
                    "b) Continuar a una velocidad reducida.",
                    "c) Continuar porque sabe que se detendrá algunos kilómetros más allá.",
                    "d) Detenerse e investigar el problema."
                ],
                correctAnswer: "d",
                points: 1
            },
{
    question: "4.- ¿Cuáles 2 cosas debe usted hacer si se le revienta un neumático delantero?",
    options: [
        "a) Cambiarse de pista y frenar a fondo.",
        "b) Frenar suavemente o dejar que el vehículo siga hasta detenerse.",
        "c) Sostener firmemente el volante manteniendo la trayectoria.",
        "d) Frenar rápida y firmemente.",
        "e) Sostener el volante con una mano advirtiendo con la otra a los demás que usted se detendrá."
    ],
    correctAnswer: ["b", "d"] ,
    points: 2
}
        ];

        // --- Variables del Estado del Quiz ---
        let currentQuizQuestions = []; // Preguntas seleccionadas para esta ronda
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedOptionButton = null; // Guarda el botón de opción seleccionado
        let selectedOptions = []; // Array para guardar múltiples selecciones

        // --- Elementos del DOM ---
        const startScreen = document.getElementById('start-screen'); // ← Añadir esta línea
        const startButton = document.getElementById('start-button'); // ← agrega esta
        const questionCounterEl = document.getElementById('question-counter');
        const scoreEl = document.getElementById('score');
        const questionTextEl = document.getElementById('question-text');
        const optionsAreaEl = document.getElementById('options-area');
        const feedbackAreaEl = document.getElementById('feedback-area');
        const checkButton = document.getElementById('check-button'); // Nuevo botón Revisar
        const nextButton = document.getElementById('next-button'); // Botón Siguiente
        const quizContainer = document.getElementById('quiz-container');
        const resultsContainer = document.getElementById('results-container');
        const finalScoreEl = document.getElementById('final-score');
        const restartButton = document.getElementById('restart-button'); // Botón en pantalla final
        const startOverButton = document.getElementById('start-over-button'); // Botón siempre visible

        // --- Funciones ---

        // Función para barajar un array (Algoritmo Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Función para iniciar un nuevo cuestionario
        function startNewQuiz() {
            // Separar preguntas por puntos
            const normalQuestions = allQuestions.filter(q => q.points === 1);
            const doubleQuestions = allQuestions.filter(q => q.points === 2);
            
            // Mezclar y seleccionar
            shuffleArray(normalQuestions);
            shuffleArray(doubleQuestions);
            
            currentQuizQuestions = [
                ...normalQuestions.slice(0, 3),
                ...doubleQuestions.slice(0, 1)
            ];
            shuffleArray(currentQuizQuestions); // Mezclar el orden final
            currentQuestionIndex = 0;
            score = 0;
            scoreEl.textContent = `Puntaje: ${score}`;
            selectedOptionButton = null;
            resultsContainer.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            checkButton.classList.add('invisible'); // Ocultar Revisar al inicio
            nextButton.classList.add('invisible'); // Ocultar Siguiente al inicio
            loadQuestion();
        }

        // Función para cargar una pregunta
        function loadQuestion() {
            selectedOptionButton = null; // Resetear selección
            selectedOptions = []; // Limpiar array de múltiples selecciones
            const currentQuestion = currentQuizQuestions[currentQuestionIndex];
            questionTextEl.textContent = currentQuestion.question;
            optionsAreaEl.innerHTML = '';
            feedbackAreaEl.textContent = '';
            feedbackAreaEl.className = 'mt-4 text-center font-medium h-6'; // Resetear clases feedback
            checkButton.classList.add('invisible'); // Ocultar botón Revisar
            nextButton.classList.add('invisible'); // Ocultar botón Siguiente

            questionCounterEl.textContent = `Pregunta ${currentQuestionIndex + 1} de ${currentQuizQuestions.length}`;

            currentQuestion.options.forEach(option => {
                const button = document.createElement('button');
                const optionLetter = option.match(/^([a-e])\)/i)?.[1].toLowerCase();
                button.textContent = option;
                button.classList.add('block', 'w-full', 'text-left', 'p-3', 'border', 'border-gray-300', 'rounded-lg', 'hover:bg-gray-100', 'transition', 'duration-150', 'ease-in-out');
                button.dataset.option = optionLetter;
                button.onclick = handleOptionSelect; // Cambiado a handleOptionSelect
                optionsAreaEl.appendChild(button);
            });
        }

        // Función para manejar la selección de una opción (sin revisar aún)
        function handleOptionSelect(event) {
    const clickedButton = event.target;
    const currentQuestion = currentQuizQuestions[currentQuestionIndex];
    const isMultiAnswer = Array.isArray(currentQuestion.correctAnswer);

    if (isMultiAnswer) {
        // Si ya está seleccionado, deseleccionar
        if (selectedOptions.includes(clickedButton)) {
            clickedButton.classList.remove('selected');
            selectedOptions = selectedOptions.filter(btn => btn !== clickedButton);
        } 
        // Si no está seleccionado y hay menos de 2, agregar
        else if (selectedOptions.length < 2) {
            clickedButton.classList.add('selected');
            selectedOptions.push(clickedButton);
        }
        // Si ya hay 2 seleccionados, reemplazar el más antiguo
        else {
            const oldestSelection = selectedOptions.shift(); // Quitar el primero
            oldestSelection.classList.remove('selected');
            clickedButton.classList.add('selected');
            selectedOptions.push(clickedButton); // Agregar el nuevo
        }
    } else {
        // Lógica original de 1 selección
        if (selectedOptionButton) selectedOptionButton.classList.remove('selected');
        selectedOptionButton = clickedButton;
        clickedButton.classList.add('selected');
    }

    checkButton.classList.toggle('invisible', !(isMultiAnswer ? selectedOptions.length === 2 : selectedOptionButton));
}

        // Función para revisar la respuesta seleccionada
        function checkAnswer() {
            const currentQuestion = currentQuizQuestions[currentQuestionIndex];
            const isMultiAnswer = Array.isArray(currentQuestion.correctAnswer);
            
            // Obtener respuestas seleccionadas y correctas
            const selected = isMultiAnswer 
                ? selectedOptions.map(btn => btn.dataset.option).sort()
                : [selectedOptionButton?.dataset.option];
                
            const correct = Array.isArray(currentQuestion.correctAnswer) 
                ? currentQuestion.correctAnswer.slice().sort()
                : [currentQuestion.correctAnswer.toLowerCase()];

            // Deshabilitar y limpiar selección
            optionsAreaEl.querySelectorAll('button').forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('selected');
            });

            // Verificar y sumar puntos
            if (JSON.stringify(selected) === JSON.stringify(correct)) {
                score += currentQuestion.points; // Usar points de la pregunta
                scoreEl.textContent = `Puntaje: ${score}`;
                feedbackAreaEl.textContent = '¡Correcto!';
                feedbackAreaEl.classList.add('text-green-600');
            } else {
                feedbackAreaEl.textContent = `Incorrecto. Respuestas correctas: ${correct.join(' y ').toUpperCase()}`;
                feedbackAreaEl.classList.add('text-red-600');
            }

            // Resaltar opciones
            optionsAreaEl.querySelectorAll('button').forEach(btn => {
                const option = btn.dataset.option;
                if (correct.includes(option)) {
                    btn.classList.add('correct');
                    if (selected.includes(option)) {
                        btn.classList.add('selected-correct');
                    }
                } else if (selected.includes(option)) {
                    btn.classList.add('incorrect');
                }
            });

            checkButton.classList.add('invisible');
            nextButton.classList.remove('invisible');
        }


        // Función para ir a la siguiente pregunta o mostrar resultados
        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuizQuestions.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        // Función para mostrar los resultados finales
        // --- Modificar función showResults ---
// Actualizar función showResults
function showResults() {
    const resultsContent = `
        <h2 class="text-2xl font-bold text-gray-800 mb-4">¡Cuestionario Completado!</h2>
        ${score >= 4 ? 
            '<p class="text-2xl font-bold text-green-600 mb-4">¡APROBADO! 🎉</p>' : 
            '<p class="text-2xl font-bold text-red-600 mb-4">¡REPROBADO! 😞</p>'}
        <p class="text-xl text-gray-700 mb-6">Tu puntaje final es: 
        <span class="font-bold">${score}</span> de 5</p>
    `;
    
    document.getElementById('dynamic-results-content').innerHTML = resultsContent;
    quizContainer.classList.add('hidden');
    resultsContainer.classList.remove('hidden');
}

// --- Agregar evento al botón de inicio ---
startButton.addEventListener('click', startNewQuiz);

// --- Ocultar quiz al cargar la página ---
window.onload = () => {
    quizContainer.classList.add('hidden');
    resultsContainer.classList.add('hidden');
    startScreen.classList.remove('hidden'); // ← Usar la variable definida
};

    // --- Event Listeners ---
    checkButton.addEventListener('click', checkAnswer);
    nextButton.addEventListener('click', nextQuestion);
    restartButton.addEventListener('click', startNewQuiz); 

    // Botón "Comenzar de nuevo" (siempre visible)
    startOverButton.addEventListener('click', () => {
        document.getElementById('start-screen').classList.remove('hidden');
        quizContainer.classList.add('hidden');
        resultsContainer.classList.add('hidden');
        startNewQuiz();
    });

    // Botón de inicio "Comenzar Examen"
    startButton.addEventListener('click', startNewQuiz);

    </script>
</body>
</html>
